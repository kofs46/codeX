<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>codeX: The Journey of a Program</title>
  <link rel="stylesheet" href="styles/recursion.css" />
</head>
<body>

  <!-- Navbar -->
  <header class="Demo_web">
    <div class="container">
      <div class="logo">
        <a href="front.html">
          <img src="assets/logo.png" alt="codeX Logo" />
        </a>
      </div>
      <nav class="menu">
        <ul>
          <li>
            <a href="index.html">
              <img src="assets/icons/smart-home.png" alt="Home Icon" class="icon-img" />
              Home
            </a>
          </li>
          <li>
            <a href="about.html">
              <img src="assets/icons/about.png" alt="About Icon" class="icon-img" />
              About
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Shared Background Wrapper -->
  <div class="home-bg">

    <!-- Hero Section -->
    <section class="compiler">
      <!-- can be <h1> as well; CSS styles both -->
      <p>Left Recursion Elimination</p>
    </section>

    <!-- Grammar Tool (Input / Process / Output) -->
    <section id="grammar-tool" class="tool-wrap">
      <div class="tool-container">

        <!-- Input card -->
        <div class="io-card">
          <h2 class="io-title">Input</h2>
          <textarea id="grammarInput" class="io-textarea"
            placeholder="Enter your grammar here. Use 'ε' or '~' for epsilon..." spellcheck="false"
            aria-label="Grammar input"></textarea>
        </div>

        <!-- Compile button centered BETWEEN the cards (matches page-1) -->
        <button id="processBtn" class="btn-primary" type="button">Compile</button>

        <!-- Output card -->
        <div class="io-card">
          <h2 class="io-title">Output</h2>
          <textarea id="grammarOutput" class="io-textarea output" readonly
            placeholder="Output will be displayed here…" aria-label="Output"></textarea>
        </div>

      </div>
    </section>
  </div> <!-- CLOSE .home-bg -->
  <!-- Cards Section -->
    <section class="card_part">
      
      <div class="d_flex">
        

        <div class="card_item">
          <div class="card_item_img">
            <img src="assets/LF.png" alt="Left Factoring" />
          </div>
          <h4>Left Factoring</h4>
          <p>
            Removes ambiguity by refactoring common prefixes in grammar
            rules.
          </p>
          <a href="fact.html">Compile</a>
        </div>

        <div class="card_item">
          <div class="card_item_img">
            <img src="assets/first.png" alt="First Logo" />
          </div>
          <h4>First ( ) Follow ( )</h4>
          <p>
           FIRST(A): terminals that begin derivations from A; FOLLOW(A): terminals appearing right after A.
          </p>
          <a href="ff.html">Compile</a>
        </div>

        <div class="card_item">
          <div class="card_item_img">
            <img src="assets/lr0.png" alt="lr0 logo" />
          </div>
          <h4>LR ( 0 )</h4>
          <p>
            LR(0): bottom-up parser using LR items without lookahead to decide grammar reductions.
          </p>
          <a href="lr0.html">Compile</a>
        </div>
      </div>
    </section>

  </div> <!-- /.home-bg -->

  <!-- Footer -->
  <footer>
    <div class="footer_container">
      <p>|| © 2025 || Team codeX || All rights reserved ||</p>
    </div>
  </footer>

  <!-- Minimal JS hook for the tool -->
  <script>
  // --- Left Recursion Elimination Functions ---
  function parseGrammarFromText(inputText) {
      const grammar = {};
      const lines = inputText.trim().split("\n");

      for (const line of lines) {
          const trimmed = line.trim();
          if (trimmed === "@") break;
          if (!trimmed.includes("->")) continue;

          const [lhs, rhs] = trimmed.split("->").map(s => s.trim());
          if (!grammar[lhs]) grammar[lhs] = [];
          const rhsList = rhs.split("|").map(s => s.trim());
          grammar[lhs].push(...rhsList);
      }
      return grammar;
  }

  function removeDirectLeftRecursion(nonTerminal, productions) {
      const alpha = [];
      const beta = [];

      productions.forEach(prod => {
          if (prod.startsWith(nonTerminal)) {
              alpha.push(prod.slice(nonTerminal.length).trim());
          } else {
              beta.push(prod);
          }
      });

      if (alpha.length === 0) {
          return { [nonTerminal]: productions };
      }

      const newNonTerminal = nonTerminal + "'";
      const updated = {};
      updated[nonTerminal] = beta.map(b => `${b} ${newNonTerminal}`);
      updated[newNonTerminal] = alpha.map(a => `${a} ${newNonTerminal}`).concat(["ε"]);
      return updated;
  }

  function removeLeftRecursion(grammar) {
      const nonTerminals = Object.keys(grammar);
      const newGrammar = {};

      for (let i = 0; i < nonTerminals.length; i++) {
          const Ai = nonTerminals[i];
          for (let j = 0; j < i; j++) {
              const Aj = nonTerminals[j];
              const newProductions = [];
              grammar[Ai].forEach(prod => {
                  if (prod.startsWith(Aj)) {
                      newGrammar[Aj].forEach(gamma => {
                          newProductions.push(gamma + prod.slice(Aj.length));
                      });
                  } else {
                      newProductions.push(prod);
                  }
              });
              grammar[Ai] = newProductions;
          }
          const result = removeDirectLeftRecursion(Ai, grammar[Ai]);
          Object.assign(newGrammar, result);
      }
      return newGrammar;
  }

  function printGrammar(grammar) {
      let output = "";
      for (const lhs in grammar) {
          output += `${lhs} -> ${grammar[lhs].join(" | ")}\n`;
      }
      return output;
  }

  // --- Hook to your HTML UI ---
  (function () {
      const input = document.getElementById('grammarInput');
      const output = document.getElementById('grammarOutput');
      const btn = document.getElementById('processBtn');

      function runProcessor() {
          const src = input.value.trim();
          if (!src) {
              output.value = "Please enter a grammar.";
              output.style.height = "auto";
              output.style.height = output.scrollHeight + "px";
              return;
          }

          const grammar = parseGrammarFromText(src);
          const updatedGrammar = removeLeftRecursion(grammar);
          let result = "Grammar After Removing Left Recursion:\n" + printGrammar(updatedGrammar);

          output.value = result;
          // auto-fit height
          output.style.height = "auto";
          output.style.height = output.scrollHeight + "px";
      }

      btn.addEventListener('click', runProcessor);
      input.addEventListener('keydown', (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') runProcessor();
      });
  })();
  </script>
</body>
</html>
